"""
========================================================================================================================
Package
========================================================================================================================
"""
import os, sys
sys.path.append(os.path.abspath(os.path.join(__file__, '..')))

from typing import List, Tuple

from Utils import *


"""
========================================================================================================================
Hand Manager
========================================================================================================================
"""
class Hand():

    """
    ====================================================================================================================
    Initialization
    ====================================================================================================================
    """
    def __init__(self, cards: List[Rank] = None, bet: float = 1.0) -> None:
        
        self.cards = cards
        self.bet = bet
        self.doubled = False

        return

    """
    ====================================================================================================================
    
    ====================================================================================================================
    """
    def add_card(self, rank: Rank) -> None:

        self.cards.append(rank)

        return

    """
    ====================================================================================================================
    
    ====================================================================================================================
    """
    def is_blackjack(self) -> bool:

        return len(self.cards) == 2 and self.best_value() == 21

    """
    ====================================================================================================================
    
    ====================================================================================================================
    """
    def is_bust(self) -> bool:

        return self.best_value() > 21

    """
    ====================================================================================================================
    
    ====================================================================================================================
    """
    def values(self) -> Tuple[int, bool]:

        total = 0
        aces = 0
        for r in self.cards:
            if r == 1:
                aces += 1
                total += 1
            else:
                total += RANK_TO_VALUE[r]
        # try to upgrade aces from 1 -> 11 one by one
        is_soft = False
        if aces > 0 and total + 10 <= 21:
            total += 10
            is_soft = True

        return total, is_soft

    """
    ====================================================================================================================
    
    ====================================================================================================================
    """
    def best_value(self) -> int:

        return self.values()[0]
    
    """
    ====================================================================================================================
    
    ====================================================================================================================
    """
    def __len__(self) -> int:

        return len(self.cards)

    """
    ====================================================================================================================
    
    ====================================================================================================================
    """
    def clone(self) -> 'Hand':

        hand_temp = Hand(self.cards[:], bet = self.bet)
        hand_temp.doubled = self.doubled

        return hand_temp    

"""
========================================================================================================================
Main Function
========================================================================================================================
"""
if __name__ == "__main__":

    hand = Hand([6, 3, 1])

    print()
    print(hand.values())
    print(len(hand))
    print()

    hand.add_card(rank = 6)

    print()
    print(hand.values())
    print(len(hand))
    print()